# Feature Specification: アラート音選択機能

**Feature Branch**: `002-alert-sound-selection`
**Created**: 2025-10-16
**Status**: Draft
**Input**: User description: "アラーム音を複数用意して、アラーム設定（x分前）ごとにアラーム音を選択できるようにします。アラーム音は、「ベル」と「銅鑼」の2つを用意します。今の音は「銅鑼」としてください。"

## User Scenarios & Testing _(mandatory)_

### User Story 1 - アラート音の種類選択 (Priority: P1)

タイムキーパーが、各アラートポイント（例：残り1分、0秒到達時）に対して、異なるアラート音（「ベル」または「銅鑼」）を選択できる。

**Why this priority**: これが本機能のコアバリューです。各アラートポイントに異なる音を設定することで、タイムキーパーは音だけで「どのタイミングのアラートか」を即座に判別でき、プレゼンテーション進行の精度が向上します。

**Independent Test**: アラート設定画面で「残り1分」に「ベル」、「0秒到達時」に「銅鑼」を設定し、タイマーを動作させて各タイミングで正しい音が再生されることを確認できます。

**Acceptance Scenarios**:

1. **Given** タイムキーパーがアラート設定画面を開いた状態、**When** 「残り1分」のアラートポイントに対して音を「ベル」に設定する、**Then** 設定が保存され、タイマー動作時に「残り1分」で「ベル」の音が再生される
2. **Given** タイムキーパーがアラート設定画面を開いた状態、**When** 「0秒到達時」のアラートポイントに対して音を「銅鑼」に設定する、**Then** 設定が保存され、タイマー動作時に「0秒到達時」で「銅鑼」の音が再生される
3. **Given** 「残り1分」が「ベル」、「0秒到達時」が「銅鑼」に設定されている状態、**When** タイマーが「1:00」に到達する、**Then** 「ベル」の音が再生される
4. **Given** 「残り1分」が「ベル」、「0秒到達時」が「銅鑼」に設定されている状態、**When** タイマーが「0:00」に到達する、**Then** 「銅鑼」の音が再生される

---

### User Story 2 - デフォルト音の設定と変更 (Priority: P2)

既存のアラート音が「銅鑼」として認識され、タイムキーパーは必要に応じてアラート音を変更できる。

**Why this priority**: 既存ユーザーの体験を維持しつつ、新しい選択肢を提供します。デフォルト値が明確であることで、ユーザーは変更が必要かどうかを判断でき、不要な設定作業を省けます。

**Independent Test**: 新しいアラートポイントを追加した際、音が自動的に「銅鑼」に設定されることを確認し、その後「ベル」に変更できることをテストできます。

**Acceptance Scenarios**:

1. **Given** 既存のアラートポイント（例：残り1分、0秒到達時）が存在する状態、**When** アラート設定画面を開く、**Then** すべての既存アラートポイントの音が「銅鑼」として表示される
2. **Given** アラート設定画面で新しいアラートポイント（例：残り30秒）を追加する場合、**When** アラートポイントを作成する、**Then** デフォルトで「銅鑼」が選択された状態で作成される
3. **Given** あるアラートポイントの音が「銅鑼」に設定されている状態、**When** そのアラートポイントの音を「ベル」に変更する、**Then** 設定が保存され、次回タイマー動作時に「ベル」が再生される

---

### User Story 3 - 音のプレビュー機能 (Priority: P3)

タイムキーパーは、アラート設定画面で各音（「ベル」「銅鑼」）を事前に試聴でき、適切な音を選択できる。

**Why this priority**: 音の違いを事前に確認することで、タイムキーパーは自信を持って設定でき、プレゼンテーション本番での予期しない音による混乱を防げます。ただし、基本的な選択機能があれば実用上は問題ないため、優先度は低めです。

**Independent Test**: アラート設定画面で「ベル」のプレビューボタンを押すと「ベル」の音が再生され、「銅鑼」のプレビューボタンを押すと「銅鑼」の音が再生されることを確認できます。

**Acceptance Scenarios**:

1. **Given** タイムキーパーがアラート設定画面を開いた状態、**When** 「ベル」の横にあるプレビューボタンを押す、**Then** 「ベル」の音が再生される
2. **Given** タイムキーパーがアラート設定画面を開いた状態、**When** 「銅鑼」の横にあるプレビューボタンを押す、**Then** 「銅鑼」の音が再生される
3. **Given** タイムキーパーが「ベル」のプレビュー再生中、**When** 「銅鑼」のプレビューボタンを押す、**Then** 「ベル」の再生が停止し、「銅鑼」の音が再生される

---

### Edge Cases

- 複数のアラートポイントが同じタイミングに設定されている場合（例：両方とも「残り1分」）、異なる音が設定されていた場合、どちらの音が優先されるか？
- アラート音の再生中に別のアラートタイミングに到達した場合、前の音は停止して新しい音が再生されるか、それとも前の音の再生が完了してから次の音が再生されるか？
- プレビュー再生中にタイマーを開始し、実際のアラートタイミングに到達した場合、プレビュー音は停止してアラート音が再生されるか？
- ブラウザの音声設定がミュートの場合、プレビュー機能やアラート音はどのように動作するか？
- アラート音ファイルの読み込みに失敗した場合（ネットワークエラー、ファイル破損など）、どのようにユーザーに通知するか？

## Requirements _(mandatory)_

### Functional Requirements

- **FR-001**: システムは、2種類のアラート音（「ベル」と「銅鑼」）を提供しなければならない
- **FR-002**: 利用者は、各アラートポイント（例：残り1分、0秒到達時）に対して、個別にアラート音を選択できなければならない
- **FR-003**: システムは、新規作成されるアラートポイントのデフォルト音を「銅鑼」に設定しなければならない
- **FR-004**: 既存のアラートポイントは、初期状態で「銅鑼」の音が設定されていなければならない
- **FR-005**: 利用者がアラート音を変更した場合、その設定は永続化され、次回のアプリケーション起動時にも保持されなければならない
- **FR-006**: システムは、各アラート音（「ベル」「銅鑼」）のプレビュー再生機能を提供しなければならない
- **FR-007**: タイマー動作時、各アラートポイントに到達した際、設定されたアラート音が正しく再生されなければならない
- **FR-008**: 異なるアラートポイントに異なる音が設定されている場合、各タイミングで対応する音が再生されなければならない
- **FR-009**: アラート音の選択UI（ドロップダウン、ラジオボタンなど）は、現在設定されている音を明確に表示しなければならない
- **FR-010**: プレビュー再生中に別のプレビューボタンを押した場合、前の音は停止し、新しい音が再生されなければならない

### Key Entities

- **アラート音**: 種類（「ベル」または「銅鑼」）、音声ファイルのパス、再生状態
- **アラートポイント設定**: 各アラートポイント（例：残り1分、0秒）に紐づく選択されたアラート音の種類
- **プレビュー状態**: 現在プレビュー再生中の音の種類、再生/停止状態

## Success Criteria _(mandatory)_

### Measurable Outcomes

- **SC-001**: 利用者は、各アラートポイントに対してアラート音を選択する操作を10秒以内に完了できる
- **SC-002**: アラート音のプレビュー再生は、ボタンを押してから0.5秒以内に開始される
- **SC-003**: アラート音の設定変更は、保存ボタンを押してから即座（1秒以内）に反映される
- **SC-004**: タイマー動作時、設定されたアラート音は、該当タイミングから1秒以内に正しく再生される
- **SC-005**: 利用者の80%以上が、初回利用時にマニュアルなしでアラート音の選択とプレビュー機能を使用できる
- **SC-006**: アラート音の設定は、ブラウザを閉じて再度開いた後も100%保持される
- **SC-007**: 異なるアラートポイントに異なる音を設定した場合、利用者の90%以上が音の違いを聞き分けられる

## Assumptions

- 既存のプレゼンテーションタイマーアプリケーションには、すでにアラート機能が実装されており、1種類の音が使用されている
- その既存の音は「銅鑼」として扱われる
- アラート音ファイル（「ベル」「銅鑼」）は、アプリケーションに同梱されているか、確実にアクセス可能な場所に配置されている
- 利用者のブラウザは、Web Audio APIまたは`<audio>`要素をサポートしている
- アラート設定は、localStorageまたは同等の永続化手段で保存される
- 本機能は、既存のアラートポイント追加・削除機能と統合される形で提供される
